<!--

    Copyright (c) 2011, salesforce.com, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without modification, are permitted provided
    that the following conditions are met:

       Redistributions of source code must retain the above copyright notice, this list of conditions and the
       following disclaimer.

       Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
       the following disclaimer in the documentation and/or other materials provided with the distribution.

       Neither the name of salesforce.com, inc. nor the names of its contributors may be used to endorse or
       promote products derived from this software without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED
    WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
    PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
    ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
    TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
    HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
    POSSIBILITY OF SUCH DAMAGE.

-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Database.com Java SDK - Creating, Updating, and Deleting Data</title>
	<link type="text/css" rel="stylesheet" href="stylesheets/docs.css" media="screen" />
	<link type="text/css" rel="stylesheet" href="stylesheets/header.css" media="screen" />
	<link type="text/css" rel="stylesheet" href="stylesheets/coderay.css" media="screen" />
</head>
<body>

  <div id="force-header"> 
    <h1><a href="force-sdk-overview.html">Database.com Java SDK</a></h1>
  </div>
<div id="bodywrap">
	<div id="docsnav">
    <!--

    Copyright (c) 2011, salesforce.com, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without modification, are permitted provided
    that the following conditions are met:

       Redistributions of source code must retain the above copyright notice, this list of conditions and the
       following disclaimer.

       Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
       the following disclaimer in the documentation and/or other materials provided with the distribution.

       Neither the name of salesforce.com, inc. nor the names of its contributors may be used to endorse or
       promote products derived from this software without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED
    WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
    PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
    ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
    TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
    HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
    POSSIBILITY OF SUCH DAMAGE.

-->

<ul> <li> <h3>Getting started</h3> <ul> 

<li><a href="force-sdk-overview">Introduction</a></li>

 <li><a href="quick-start">Quick Start</a></li>

 <li><a href="sts">SpringSource Tool Suite</a></li>

 <li><a href="java-database-terminology">Database.com Terminology</a></li>

 </ul> </li>

 <li> <h3>Persistence</h3> <ul> 
 
 <li><a href="jpa-provider">JPA Provider Overview</a></li>

 <li><a href="jpa-config-persistence">Configuration</a></li>

 <li><a href="jpa-annotations-standard">Standard JPA Annotations</a></li>

 <li><a href="jpa-annotations-custom">Custom Database.com Annotations</a></li>

 <li><a href="jpa-cud">Creating, Updating, and Deleting Data</a></li>

 <li><a href="jpa-transactions">Transactions</a></li>
  
 <li><a href="jpa-queries">Querying with JPQL</a></li>

 <li><a href="jpa-queries-soql">Querying with SOQL</a></li>

 <li><a href="database-com-datatypes">Database.com Data Types</a></li>

 <li><a href="java-db-com-datatypes-map">Java to Database.com Data Types</a></li>

 <li><a href="jpa-spec-support">JPA 2.0 Specification Support</a></li>

 </ul> </li>

 <li> <h3>Authentication</h3> <ul> 
 
 <li><a href="oauth-auth">OAuth Authentication</a></li>

 <li><a href="spring-security">Spring Security Plugin</a></li>

 <li><a href="retrieve-user-data">Retrieving User Data</a></li>

 </ul> </li>

 <li> <h3>Reference</h3> <ul>

 <li><a href="apidocs">Javadoc</a></li>

 </ul> </li>

 <li> <h3>Low-level Connector</h3> <ul> <li><a href="connection-url">Connection Configuration</a></li>

 <li><a href="native-api">Native API Clients</a></li>

 </ul> </li>

 </ul>
 
<!--
	topic 'quick-start',        'Quick Start Guide'
	topic 'sts',                'SpringSource Tool Suite'
	topic 'java-force-terminology', 'Force.com Terminology'
end

section 'persistence', "Persistence" do
	topic 'jpa-provider',             'JPA Provider Overview'
	topic 'jpa-config-persistence',   'Configuration'
	topic 'jpa-annotations-standard', 'Standard JPA Annotations'
	topic 'jpa-annotations-custom',   'Custom Force.com Annotations'
	topic 'jpa-cud',                  'Creating, Updating, and Deleting Data'
	topic 'jpa-queries',              'Querying with JPQL'
	topic 'jpa-queries-soql',         'Querying with SOQL'
	topic 'force-datatypes',          'Force.com Data Types'
	topic 'java-force-datatypes-map', 'Java to Force.com Data Types'
	topic 'jpa-spec-support',         'JPA 2.0 Specification Support'
end

section 'authentication', "Authentication" do
	topic 'oauth-auth'  ,       'OAuth Authentication'
	topic 'spring-security',    'Spring Security Plugin'
	topic 'retrieve-user-data',    'Retrieving User Data'
end

section 'connector', "Low-level Connector" do
	topic 'connection-url',     'Connection Configuration'
  topic 'native-api',         'Native API Clients'
end

-->

	</div>

	<div id="content">
		<div class="topic_content">
      <h1>Creating, Updating, and Deleting Data</h1>

<p>After you have modeled your entity in a Java class, you can
use it to create, update, or delete records for that entity type. First, you must get an <code>EntityManager</code>
instance.</p>

<h2>Using an EntityManager</h2>

<p>An <code>EntityManager</code> instance is used to manage the state and life cycle of objects within a persistence unit. The entity manager
is responsible for creating and removing persistent entity instances and finding entities by their primary key or other query criteria.</p>

<p>You access an entity manager by first creating an instance of an <code>EntityManagerFactory</code> object for a persistence unit defined
in <code>persistence.xml</code>. Using the factory class, you can then create an <code>EntityManager</code> object.</p>

<p>The following sample creates an entity manager. The details of interacting with your data after creating the entity manager is
omitted.</p>

<pre><code>private void setupEntityManager(String persistenceUnitName)
{
    EntityManagerFactory factory =
        Persistence.createEntityManagerFactory(persistenceUnitName);
    EntityManager em = factory.createEntityManager();

    try {
        // Use the entity manager to interact with your data

    }
    catch (PersistenceException pex) {
        pex.printStackTrace();
    }
    finally {
        em.close();
    }
}
</code></pre>

<h2>Persisting Records</h2>

<p>After you have instantiated an <code>EntityManager</code>, you can create, update, or delete records for entities with an associated Java class.</p>

<p><img src="http://na1.salesforce.com//img/help/helpWarning_icon.gif" alt="Caution icon" /> <strong>Caution</strong>: To update or remove a record, you must first use the <code>find()</code> method to get the corresponding object and then call <code>merge()</code> or <code>remove()</code> in the same transaction. If you use a constructor to create an object and call <code>setId()</code> to identify the record instead of calling <code>find()</code>, the existing record will not be updated with a <code>merge()</code> call or deleted with a <code>remove()</code> call.</p>

<p>Here is a trivial sample that creates, updates, and then deletes a record for a Student entity. For more information on transactions, see <a href="jpa-transactions">Transactions</a>.</p>

<pre><code>private void sampleCreateUpdateDelete(String persistenceUnitName)
{
    EntityManagerFactory factory =
        Persistence.createEntityManagerFactory(persistenceUnitName);
    EntityManager em = factory.createEntityManager();

    EntityTransaction tx;
    try {
        // Create a student object
        Student student = new Student();
        student.setFirstName("Fabio");
        student.setLastName("Socrates");
        student.setEmail("socrates@salesforcetest123.com");
        Calendar cal = Calendar.getInstance();
        cal.set(1990, 5, 1, 0, 0, 0);
        cal.set(Calendar.MILLISECOND, 0);// We do not preserve ms resolution
        Date dob = cal.getTime();
        student.setDateOfBirth(dob);

        // Instantiate a transaction
        tx = em.getTransaction();
        // Start the transaction for creating a new record
        tx.begin();
        em.persist(student);
        tx.commit();

        tx = em.getTransaction();
        tx.begin();
        // Read back the object
        // Note: you should execute find() and remove() in the same transaction
        Student foundStudent = em.find(Student.class, student.getId());

        // Now update the email field for the record
        foundStudent.setEmail(fabio.socrates@salesforcetest.com);
        em.merge(foundStudent);

        // Finally, delete the record
        em.remove(foundStudent);
        tx.commit();

    }
    catch (PersistenceException pex) {
        pex.printStackTrace();
    } finally {
        em.close();
        tx.rollback();
    }
}
</code></pre>

<p><strong>Note</strong>: Each custom Java entity has a name field. If you create a record that doesn't have a name value, the ID of the
record is inserted as its name.</p>

		</div>
	</div>
</div>
</body>
</html>
